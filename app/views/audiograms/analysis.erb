<!-- app/views/audiograms/analysis.html.erb -->
<div class="container mt-5 mb-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>User Profile</h2>
    <%= button_to 'Logout', logout_path, method: :delete, class: 'btn btn-outline-secondary' %>
  </div>

  <h1 class="fw-bold mb-5 text-center">Your Hearing Analysis</h1>

  <!-- Audiogram Results Section -->
  <div class="row mb-5">
    <div class="col-md-8">
      <h4>Your Audiogram Results</h4>
      <div class="border rounded-3 bg-white p-3">
        <canvas id="resultsChart" height="200"></canvas>
      </div>
    </div>

    <div class="col-md-4">
      <h5 class="fw-bold">Diagnosis</h5>
      <div class="card shadow-sm p-3">
        <p class="fw-semibold mb-1">
          You have <span class="text-danger">Moderate to Severe</span> hearing loss in both ears.
        </p>
        <p class="small text-muted mb-0">* Consult with a specialist for personalized advice.</p>
      </div>
    </div>
  </div>

  <hr class="my-4" />

  <!-- Create New Audiogram + Recommended Hearing Aids -->
  <div class="row mt-4">
    <div class="col-md-6">
      <h5>Create New Audiogram</h5>
      <div class="border rounded-3 p-3 bg-white">
        <canvas id="newAudiogramChart" height="180"></canvas>
      </div>
    </div>

    <div class="col-md-6">
      <h5>Recommended Hearing Aids</h5>
      <button class="btn btn-dark w-100 mb-3">FIND RECOMMENDED HEARING AIDS</button>

      <div class="card mb-3 p-3">
        <strong>Model A:</strong> For active and social lifestyles.
        <p class="small text-muted mb-0">Designed for clarity in busy environments.</p>
      </div>

      <div class="card mb-3 p-3">
        <strong>Model B:</strong> For active users needing adaptive noise reduction.
        <p class="small text-muted mb-0">Ideal for conversations and outdoor use.</p>
      </div>

      <div class="card p-3">
        <strong>Model C:</strong> For mild to moderate hearing loss.
        <p class="small text-muted mb-0">Lightweight and discreet with Bluetooth streaming.</p>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<%= javascript_include_tag "https://cdn.jsdelivr.net/npm/chart.js" %>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // ----- Main Audiogram Results -----
        const ctx = document.getElementById("resultsChart");
        new Chart(ctx, {
            type: "line",
            data: {
                labels: [250, 500, 1000, 2000, 4000, 8000],
                datasets: [
                    {
                        label: "Right Ear (O)",
                        data: [40, 55, 65, 75, 90, 100],
                        borderColor: "#dc3545",
                        backgroundColor: "#dc3545",
                        fill: false,
                        tension: 0.3,
                        pointBackgroundColor: "#dc3545"
                    },
                    {
                        label: "Left Ear (X)",
                        data: [25, 35, 50, 60, 80, 90],
                        borderColor: "#0d6efd",
                        backgroundColor: "#0d6efd",
                        fill: false,
                        tension: 0.3,
                        pointBackgroundColor: "#0d6efd"
                    }
                ]
            },
            options: {
                plugins: {
                    legend: { position: "top" },
                },
                scales: {
                    y: {
                        title: { display: true, text: "Hearing Level (dB)" },
                        min: 0,
                        max: 120,
                        ticks: { stepSize: 20 }
                    },
                    x: {
                        title: { display: true, text: "Frequency (Hz)" }
                    }
                }
            }
        });

        // ----- New Audiogram Placeholder -----
        const ctx2 = document.getElementById("newAudiogramChart");
        new Chart(ctx2, {
            type: "line",
            data: {
                labels: [250, 500, 1000, 2000, 4000, 8000],
                datasets: [{
                    data: [20, 45, 70, 50, 35, 25],
                    borderColor: "#6c757d",
                    borderWidth: 2,
                    fill: false,
                    tension: 0.3,
                    pointBackgroundColor: "#6c757d"
                }]
            },
            options: {
                plugins: { legend: { display: false } },
                scales: {
                    y: {
                        title: { display: true, text: "Hearing Lev (dB)" },
                        min: 0,
                        max: 120
                    },
                    x: {
                        title: { display: true, text: "Frequency (Hz)" }
                    }
                }
            }
        });
    });
</script>
